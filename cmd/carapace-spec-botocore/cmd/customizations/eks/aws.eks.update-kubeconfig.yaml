# yaml-language-server: $schema=https://carapace.sh/schemas/command.json
name: update-kubeconfig
description: Configures kubectl so that you can connect to an Amazon EKS cluster.
flags:
  --name=!: The name of the cluster for which to create a kubeconfig entry.
  --kubeconfig=: Optionally specify a kubeconfig file to append with your configuration.
  --role-arn=: To assume a role for cluster authentication, specify an IAM role ARN with this option.
  --proxy-url=: Optionally specify a proxy url to route traffic via when connecting to a cluster.
  --dry-run: Print the merged kubeconfig to stdout instead of writing it to the specified file.
  --verbose: Print more detailed output when writing to the kubeconfig file, including the appended entries.
  --alias=: Alias for the cluster context name.
  --user-alias=: Alias for the generated user name.
  --assume-role-arn=: To assume a role for retrieving cluster information, specify an IAM role ARN with this option.
documentation:
  command: |
    Configures kubectl so that you can connect to an Amazon EKS cluster.
    
    > Note:
    >
    > To use the resulting configuration, you must have kubectl installed and in your PATH environment variable.
    > This command constructs a configuration with prepopulated server and certificate authority data values for a specified cluster. You can specify an IAM role ARN with the ``--role-arn` option to use for authentication when you issue kubectl commands. Otherwise, the IAM entity in your default AWS CLI or SDK credential chain is used. You can view your default AWS CLI or SDK identity by running the `aws sts get-caller-identity` command.
    
    The resulting kubeconfig is created as a new file or merged with an existing kubeconfig file using the following logic:
    
    If you specify a path with the `--kubeconfig option`, then the resulting configuration file is created there or merged with an existing kubeconfig at that location.
    Or, if you have the `KUBECONFIG` environment variable set, then the resulting configuration file is created at the first entry in that variable or merged with an existing kubeconfig at that location.
    Otherwise, by default, the resulting configuration file is created at the default kubeconfig path (`.kube/config`) in your home directory or merged with an existing kubeconfig at that location.
    If a previous cluster configuration exists for an Amazon EKS cluster with the same name at the specified path, the existing configuration is overwritten with the new configuration.
    When update-kubeconfig writes a configuration to a kubeconfig file, the current-context of the kubeconfig file is set to that configuration.
    You can use the `--dry-run` option to print the resulting configuration to stdout instead of writing it to the specified location.
  flag:
    name: |
      The name of the cluster for which to create a kubeconfig entry.
      This cluster must exist in your account and in the specified or configured default Region for your AWS CLI installation.
    kubeconfig: |
      Optionally specify a kubeconfig file to append with your configuration.
      By default, the configuration is written to the first file path in the KUBECONFIG environment variable (if it is set) or the default kubeconfig path (.kube/config) in your home directory.
    role-arn: |
      To assume a role for cluster authentication, specify an IAM role ARN with this option.
      For example, if you created a cluster while assuming an IAM role, then you must also assume that role to connect to the cluster the first time.
    proxy-url: Optionally specify a proxy url to route traffic via when connecting to a cluster.
    dry-run: Print the merged kubeconfig to stdout instead of writing it to the specified file.
    verbose: Print more detailed output when writing to the kubeconfig file, including the appended entries.
    alias: Alias for the cluster context name. Defaults to match cluster ARN.
    user-alias: Alias for the generated user name. Defaults to match cluster ARN.
    assume-role-arn: |
      To assume a role for retrieving cluster information, specify an IAM role ARN with this option.
      Use this for cross-account access to get cluster details from the account where the cluster resides.
